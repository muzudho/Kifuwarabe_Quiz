import datetime


class BoardHelper():
    """ç›¤æ“ä½œã‚’åŠ©ã‘ã‚‹æ©Ÿèƒ½é›†"""


    @staticmethod
    def get_horizontal_sq_by_file_rank(file, rank):
        """ç­‹ç•ªå·ã¨æ®µç•ªå·ã¨ãƒã‚¹ç•ªå·ã¯ 0 ã‹ã‚‰å§‹ã¾ã‚‹ã¨ã—ã€
        ç­‹ç•ªå·ã¨æ®µç•ªå·ã‚’æ¸¡ã™ã¨ã€æ¨ªå‹ã®ãƒã‚¹ç•ªå·ã‚’è¿”ã—ã¾ã™
        """
        return 9 * rank + (8 - file)


    @staticmethod
    def get_file_rank_by_horizontal_sq(horizontal_serial_sq):
        """ç­‹ç•ªå·ã¨æ®µç•ªå·ã¨ãƒã‚¹ç•ªå·ã¯ 0 ã‹ã‚‰å§‹ã¾ã‚‹ã¨ã—ã€
        æ¨ªå‹ã®ãƒã‚¹ç•ªå·ã‚’æ¸¡ã™ã¨ã€ç­‹ç•ªå·ã¨æ®µç•ªå·ã‚’è¿”ã—ã¾ã™
        """
        file = (8 - horizontal_serial_sq % 9)
        rank = horizontal_serial_sq // 9

        return (file, rank)


    @staticmethod
    def jsa_to_sq(jsa_sq):
        """ãƒ—ãƒ­æ£‹å£«ã‚‚ä½¿ã£ã¦ã„ã‚‹ãƒã‚¹ç•ªå·ã®æ›¸ãæ–¹ã¯
        ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã«ã¯ä½¿ã„ã¥ã‚‰ã„ã®ã§ã€
        0 ã‹ã‚‰å§‹ã¾ã‚‹ãƒã‚¹ã®é€šã—ç•ªå·ã«å¤‰æ›ã—ã¾ã™

        è±†çŸ¥è­˜ï¼šã€€åã®ä½ã‚’ç­‹ã€ä¸€ã®ä½ã‚’æ®µã¨ã™ã‚‹ãƒã‚¹ç•ªå·ã¯ã€
                å°†æ£‹ã®æ£‹å£«ã‚‚æ£‹è­œã«ç”¨ã„ã¦ã„ã‚‹è¨˜æ³•ã§ã™ã€‚
                JSA ã¯æ—¥æœ¬å°†æ£‹é€£ç›Ÿï¼ˆJapan Shogi Associationï¼‰

        Parameters
        ----------
        jsa_sq : int
            ç­‹ã¨æ®µã¯ 1 ã‹ã‚‰å§‹ã¾ã‚‹æ•´æ•°ã¨ã—ã€
            åã®ä½ã‚’ç­‹ã€ä¸€ã®ä½ã‚’æ®µã¨ã™ã‚‹ãƒã‚¹ç•ªå·
        """

        file = jsa_sq // 10 - 1
        rank = jsa_sq % 10 - 1

        return BoardHelper.get_horizontal_sq_by_file_rank(file, rank)


    @staticmethod
    def sq_to_jsa(horizontal_serial_sq):
        """0 ã‹ã‚‰å§‹ã¾ã‚‹ãƒã‚¹ã®é€šã—ç•ªå·ã¯èª­ã¿ãšã‚‰ã„ã®ã§ã€
        åã®ä½ã‚’ç­‹ã€ä¸€ã®ä½ã‚’æ®µã«ãªã‚‹ã‚ˆã†å¤‰æ›ã—ã¾ã™ã€‚
        ã“ã‚Œã¯å°†æ£‹ã®æ£‹å£«ã‚‚æ£‹è­œã«ç”¨ã„ã¦ã„ã‚‹è¨˜æ³•ã§ã™ã€‚
        JSA ã¯æ—¥æœ¬å°†æ£‹é€£ç›Ÿï¼ˆJapan Shogi Associationï¼‰

        Parameters
        ----------
        serial_sq : int
            0 ã‹ã‚‰å§‹ã¾ã‚‹ãƒã‚¹ã®é€šã—ç•ªå·
        """

        (file,
         rank) = BoardHelper.get_file_rank_by_horizontal_sq(horizontal_serial_sq)

        return 10 * (file + 1) + (rank + 1)


class DebugHelper():
    """ãƒ‡ãƒãƒƒã‚°ã‚’åŠ©ã‘ã‚‹æ©Ÿèƒ½é›†"""



    @staticmethod
    def stringify_3characters_horizontal_board(squares):
        """ï¼‘ãƒã‚¹ã«ï¼“æ¡ã‚’è¡¨ç¤ºã§ãã‚‹æ¨ªå‹ã®è¡¨

        Parameters
        ----------
        squares : [81]
            ï¼˜ï¼‘ãƒã‚¹ã®è¡¨
        """

        # é•·ã„å¤‰æ•°åã‚’çŸ­ãã™ã‚‹
        s = squares

        return f"""\
  9   8   7   6   5   4   3   2   1
+---+---+---+---+---+---+---+---+---+
|{s[0]:3}|{s[1]:3}|{s[2]:3}|{s[3]:3}|{s[4]:3}|{s[5]:3}|{s[6]:3}|{s[7]:3}|{s[8]:3}| ä¸€
+---+---+---+---+---+---+---+---+---+
|{s[9]:3}|{s[10]:3}|{s[11]:3}|{s[12]:3}|{s[13]:3}|{s[14]:3}|{s[15]:3}|{s[16]:3}|{s[17]:3}| äºŒ
+---+---+---+---+---+---+---+---+---+
|{s[18]:3}|{s[19]:3}|{s[20]:3}|{s[21]:3}|{s[22]:3}|{s[23]:3}|{s[24]:3}|{s[25]:3}|{s[26]:3}| ä¸‰
+---+---+---+---+---+---+---+---+---+
|{s[27]:3}|{s[28]:3}|{s[29]:3}|{s[30]:3}|{s[31]:3}|{s[32]:3}|{s[33]:3}|{s[34]:3}|{s[35]:3}| å››
+---+---+---+---+---+---+---+---+---+
|{s[36]:3}|{s[37]:3}|{s[38]:3}|{s[39]:3}|{s[40]:3}|{s[41]:3}|{s[42]:3}|{s[43]:3}|{s[44]:3}| äº”
+---+---+---+---+---+---+---+---+---+
|{s[45]:3}|{s[46]:3}|{s[47]:3}|{s[48]:3}|{s[49]:3}|{s[50]:3}|{s[51]:3}|{s[52]:3}|{s[53]:3}| å…­
+---+---+---+---+---+---+---+---+---+
|{s[54]:3}|{s[55]:3}|{s[56]:3}|{s[57]:3}|{s[58]:3}|{s[59]:3}|{s[60]:3}|{s[61]:3}|{s[62]:3}| ä¸ƒ
+---+---+---+---+---+---+---+---+---+
|{s[63]:3}|{s[64]:3}|{s[65]:3}|{s[66]:3}|{s[67]:3}|{s[68]:3}|{s[69]:3}|{s[70]:3}|{s[71]:3}| å…«
+---+---+---+---+---+---+---+---+---+
|{s[72]:3}|{s[73]:3}|{s[74]:3}|{s[75]:3}|{s[76]:3}|{s[77]:3}|{s[78]:3}|{s[79]:3}|{s[80]:3}| ä¹
+---+---+---+---+---+---+---+---+---+
"""


class Kifuwarabe():
    """ããµã‚ã‚‰ã¹ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰"""


    @staticmethod
    def main(file_name, n_sq):
        """ãƒ¡ã‚¤ãƒ³ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

        Parameters
        ----------
        file_name : str
            å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å
        n_sq : int
            æ¡‚é¦¬ï¼ˆkNightï¼‰ã®ã„ã‚‹ãƒã‚¹ç•ªå·ï¼ˆSQuareï¼‰
        """

        # ç›¤ã®æ¨ªå¹…
        board_width = 9

        # åˆ©ãã®ã‚ã‚‹ãƒã‚¹ç•ªå·ã®é›†åˆ
        effect_sq_set = set()
        #
        #   ğŸ‘†ã€€è±†çŸ¥è­˜ï¼šã€€ãƒã‚§ã‚¹ã§ã¯åˆ©ãã¯ controlã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼å°†æ£‹ã§ã¯åˆ©ãã¯ effectã€‚
        #
        #               åˆ©ãã‚’ï¼“é§’é–¢ä¿‚ã®ç‰¹å¾´ã¨ã—ã¦åŠ ãˆãŸã“ã¨ã§æœ‰åãªå°†æ£‹ã‚¨ãƒ³ã‚¸ãƒ³ã«ã€€ç¬¬ï¼’ï¼”å›ä¸–ç•Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿å°†æ£‹é¸æ‰‹æ¨©ã«å‚åŠ ã—ãŸ AWAKE ãŒã‚ã‚‹ãŒã€
        #               å½“æ™‚ã®ã‚„ã­ã•ã‚“ã®ãƒ–ãƒ­ã‚°ã«ã‚ˆã‚‹ã¨ã€
        #               ã“ã®é ƒã® AWAKE ã®å·¨ç€¬ã•ã‚“ã¯åˆ©ãã‚’ attack ã¨å‘¼ã³ã€
        #               Apery ã®å¹³å²¡ã•ã‚“ã¯åˆ©ãã‚’ effect ã¨å‘¼ã³ã€
        #               ç„¡æ˜ã‚„ã‚ªã‚ºã®ã‚¢ãƒ¡ãƒªã‚«äººã® Wada ã•ã‚“ã¯åˆ©ãã‚’ control ã¨å‘¼ã³ã€
        #               Stockfishã®ä½œè€…ã¯ã‚¤ã‚¿ãƒªã‚¢ç³»ã‹ãƒãƒ«ã‚¦ã‚§ãƒ¼ç³»ã ã‹ã‚‰ã‹åˆ©ãã‚’ effect ã¨å‘¼ã‚“ã§ã„ã‚‹ã€‚
        #               è‹±èªã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã§ãªã„é–‹ç™ºè€…ãŒå¤šã„ã‹ã‚‰ã‹ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼å°†æ£‹ã§ã¯ effect ã§è½ã¡ç€ã„ãŸã€‚
        #
        #               ğŸ“– [AWAKEã®KPEã®å®Ÿè£…ã«å‘ã‘ã¦ ãã®1](https://yaneuraou.yaneu.com/2014/12/25/awake%E3%81%AEkpe%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AB%E5%90%91%E3%81%91%E3%81%A6-%E3%81%9D%E3%81%AE1/)
        #

        # æ¡‚é¦¬ã®å³ã®æ–¹ã®åˆ©ãï¼ˆeffectï¼‰
        #
        #   ğŸ‘‡ã€€è±†çŸ¥è­˜ï¼šã€€ï¼’æ®µä¸Šã®å³ãƒã‚¹ã¯ã€ç›¤ã®æ¨ªå¹…ï¼’ã¤åˆ†ã‚ˆã‚Šï¼‘ã¤æ‰‹å‰
        #
        right_effect_sq = n_sq - (2 * board_width - 1)
        effect_sq_set.add(right_effect_sq)

        # æ¡‚é¦¬ã®å·¦ã®æ–¹ã®åˆ©ã
        #
        #   ğŸ‘‡ã€€è±†çŸ¥è­˜ï¼šã€€ï¼’æ®µä¸Šã®å·¦ãƒã‚¹ã¯ã€ç›¤ã®æ¨ªå¹…ï¼’ã¤åˆ†ã‚ˆã‚Šï¼‘ã¤å¥¥
        #
        left_effect_sq = n_sq - (2 * board_width + 1)
        effect_sq_set.add(left_effect_sq)

        # ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
        print(f"""[{datetime.datetime.now()}] write `{file_name}` file...
    n_masu:{BoardHelper.sq_to_jsa(n_sq)}  left_effect_masu:{BoardHelper.sq_to_jsa(left_effect_sq)}  right_effect_masu:{BoardHelper.sq_to_jsa(right_effect_sq)}
""")


        with open(file_name, 'w', encoding='utf-8') as f:

            # ï¼‘ãƒã‚¹ã«ï¼“æ¡ã®æ–‡å­—åˆ—ãŒå…¥ã‚‹ã¨ã—ã€ãã®ï¼˜ï¼‘ãƒã‚¹åˆ†
            squares = ['   '] * 81

            serial_effect_index = 0

            for target_rank in range(0,9):
                for target_file in reversed(range(0,9)):
                    target_sq = BoardHelper.get_horizontal_sq_by_file_rank(
                            file=target_file,
                            rank=target_rank)

                    if target_sq == n_sq:
                        squares[target_sq] = 'you'

                    elif target_sq in effect_sq_set:

                        squares[target_sq] = f'{serial_effect_index:3}'
                        serial_effect_index += 1


            # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
            f.write(DebugHelper.stringify_3characters_horizontal_board(squares))


########################################
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚
########################################

if __name__ == '__main__':
    """ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚"""

    Kifuwarabe.main(
            file_name="actual_55N.txt",
            # ï¼•äº”æ¡‚
            n_sq=BoardHelper.jsa_to_sq(55))

    Kifuwarabe.main(
            file_name="actual_97N.txt",
            # ï¼™ä¸ƒæ¡‚
            n_sq=BoardHelper.jsa_to_sq(97))
